<?phprequire_once($_SERVER["DOCUMENT_ROOT"] . '/backend/lib/App/tool/canvas.php');class aulafotos extends App_Controller{    public function index_action()    {        return $this->View("indexAula");    }    /****************** CRUD ******************************/    public function inserirfotos()    {        // seta o id do cliente        $id = new App_System();        $id->_urlAjax = $_POST['url'];        $id->setExplodeAjax();        $id->setControllerAjax();        $id->setActionAjax();        $id->setParamsAjax();        $dados = $id->getParamsAjax();        $model = new App_Model_aulafotosModel();        // $arr = array(        //     'img' => $dados['img'],        //     'aula' => $dados['id']        // );        // $model_inserir = $model->aulaCadastrar($arr);                $arr = array(            'img' => $dados['img'],            'aula' => $dados['id']        );        $model_inserir = $model->aulaCadastrar($arr);          print_r($model_inserir);    }    public function chamafotos()    {        // seta o id do cliente        $id = new App_System();        $id->_urlAjax = $_POST['url'];        $id->setExplodeAjax();        $id->setControllerAjax();        $id->setActionAjax();        $id->setParamsAjax();        $dados = $id->getParamsAjax();        $model = new App_Model_aulafotosModel();        $model_listar = $model->aulaSelecionarFotos($dados['id']);        foreach ($model_listar as $pf):            $lista = '                <div class="col-sm-3 col-md-3 order"  id="' . $pf['arq_id'] . '">                    <div class="thumbnail">                      <div class="form-group form-group-default" id="img-' . $pf['arq_id'] . '">';                                                $img_exp = explode(".", $pf["arq_file"]);                        if($img_exp[1] == "pdf"):                                    $lista .=   '<a href="/images/aula/<?php echo $view_aula_disciplina; ?>/<?php echo $pf["arq_file"]; ?>" target="_blank" ><img src="/images/tumbnailpdf.jpg" class="img-responsive"></a>';                         else:              $lista .=  '<img                            src="/images/aula/<?php echo $view_aula_disciplina; ?>/<?php echo $pf["arq_file"]; ?>"                            class="img-responsive">';                                                    endif;                                  $lista .=  '</div>                      <div class="form-group form-group-default center-block" style="min-height:0 !improdant; padding-top:5px !improdant;">                        <h6>' . $pf['arq_file'] . '</h6>                      </div>                      <div class="caption">                                                                        <a name="aulafotosDel" data-gldel="' . $pf['arq_id'] . '" class="btn btn-danger" href="#" data-toggle="modal" data-target="#modalshow">Deletar</a>                                                       </div>                    </div>                  </div>';            echo $lista;        endforeach;    }    //ALTERAR    public function selecionar($view = NULL)    {        // seta o id do cliente        $id = new App_System();        $id->_urlAjax = $_POST['url'];        $id->setExplodeAjax();        $id->setControllerAjax();        $id->setActionAjax();        $id->setParamsAjax();        $ident = $id->getParamsAjax("id");        $aula_alt = new App_Model_aulaModel();        $aula_lista = $aula_alt->aulaSelecionar($ident);        $dados['aula_disciplina'] = $aula_lista[0]['aula_disciplina'];                      /*DADOS aula FOTOS*/        $model_fotos = new App_Model_aulafotosModel();        $model_fotos = $model_fotos->aulaSelecionarFotos($ident);        $dados['aulafotos'] = $model_fotos;        if ($view != NULL):            return $dados;        else:            $this->View("alterarAulafotos", $dados);        endif;    }    //ALTERAÇÃO    public function alteracao()    {        // seta o id do cliente        $id = new App_System();        $id->_urlAjax = $_POST['url'];        $id->setExplodeAjax();        $id->setControllerAjax();        $id->setActionAjax();        $id->setParamsAjax();        $dados = $id->getParamsAjax();        //print_r($dados);        $model = new App_Model_aulafotosModel();        $model_update = $model->aulaAlteracao($dados);        $model2 = new App_Model_aulaModel();        $model_update2 = $model2->aulaAlteracaoImg($dados);        echo $model_update;    }    //ALTERAÇÃO2    public function alteracaocad()    {        // seta o id do cliente        $id = new App_System();        $id->_urlAjax = $_POST['url'];        $id->setExplodeAjax();        $id->setControllerAjax();        $id->setActionAjax();        $id->setParamsAjax();        $dados = $id->getParamsAjax();        $model = new App_Model_aulaModel();        $model_update = $model->aulaAlteracaocad($dados, $_SESSION['aulaID']);        echo $model_update;    }    //ROTATION IMG LEFT E RIGHT    // public function rotationImg(){    //     // seta o id do cliente    //     $id = new App_System();    //     $id->_urlAjax = $_POST['url'];    //     $id->setExplodeAjax();    //     $id->setControllerAjax();    //     $id->setActionAjax();    //     $id->setParamsAjax();    //     $dados = $id->getParamsAjax();    //     $model = new App_Model_aulafotosModel();    //     $model_sel = $model->aulaSelecionar($dados['id']);    //     $config = unserialize (CONFIG_DB);    //     //echo $dados['id'];    //     $uploadDir =  $_SERVER['DOCUMENT_ROOT'].'/images/aula/'.$dados['aula'].'/'.$model_sel[0]['D011_Imagem'];    //     //echo $uploadDir;    //     if($dados['status'] == 'esq'):    //         $img = new canvas();    //         $img->carrega($uploadDir)    //         //->hexa('#FFFFFF')    //         ->gira(90)    //         ->grava($uploadDir,100);    //         $mytime = time();    //         //echo '/qualidade.php?&lar=500&alt=400&imagem=images/aula/'.$dados['aula'].'/'.$model_sel[0]['D011_Imagem'];    //         echo 'images/aula/'.$dados['aula'].'/'.$model_sel[0]['D011_Imagem']."?".$mytime;    //     endif;    //     if($dados['status'] == 'dir'):    //         $img = new canvas();    //         $img->carrega($uploadDir)    //         //->hexa('#FFFFFF')    //         ->gira(-90)    //         ->grava($uploadDir,100);    //         $mytime = time();    //         //echo '/qualidade.php?&lar=500&alt=400&imagem=images/aula/'.$dados['aula'].'/'.$model_sel[0]['D011_Imagem'];    //         echo 'images/aula/'.$dados['aula'].'/'.$model_sel[0]['D011_Imagem']."?".$mytime;    //     endif;    // }    //DELETAR    public function deletar()    {        // seta o id do cliente        $id = new App_System();        $id->_urlAjax = $_POST['url'];        $id->setExplodeAjax();        $id->setControllerAjax();        $id->setActionAjax();        $id->setParamsAjax();        $ident = $id->getParamsAjax();        $model = new App_Model_aulafotosModel();        $model_fotos = $model->aulaSelecionar($ident['id']);        $model_fotosd = $model->aulaDeletar($ident['id']);        $modelg = new App_Model_aulaModel();        $model_alt_gl = $modelg->aulaSelecionar($model_fotos[0]['aula_id']);        unlink($_SERVER['DOCUMENT_ROOT'] . "/images/aula/" . $model_alt_gl[0]['aula_disciplina'] . "/" . $model_fotos[0]['arq_file']);        echo $model_fotosd;    }    //ORDENAR    public function ordenar()    {        // seta o id do cliente        $id = new App_System();        $id->_urlAjax = $_POST['url'];        $id->setExplodeAjax();        $id->setControllerAjax();        $id->setActionAjax();        $id->setParamsAjax();        $dados = $id->getParamsAjax();        $ordem = explode(",", $dados["ordem"]);        $model_fotos = new App_Model_aulafotosModel();        foreach ($ordem as $key => $value):            $alt_ordem = $model_fotos->aulaOrdenar($key, $value);        endforeach;        /*$model = new App_Model_aulaModel();        $model_update = $model->aulaOrdenar($dados);        echo $alt_ordem;*/    }    /***************     PAGINA     *********************/    public function listar()    {        unset($_SESSION['aulaID']);        $aula_cad = new App_Model_aulaModel();        $aula_lista_cad = $aula_cad->listaaula();        global $start;        $parm = $start->_params;        if (!empty($parm['p'])):            $pagination = $parm['p'];        else:            $pagination = 1;        endif;        $pag = new App_Controller_paginacaoController();        $paginacao = $pag->paginacao("d011aula_fotos", NULL, "D011_Uid DESC", "/backend/aulafotos/listar/p", $pagination);        if (!empty($paginacao)):            $dados['aula_lista'] = $paginacao;            $dados['aula_curso'] = $paginacao;            /*DADOS aula FOTOS*/            $arr = "";            $destaque = "";            $categoria = "";            foreach ($aula_lista_cad as $foto):                $model_cat = new App_Model_aulacatModel();                $rs_cat = $model_cat->aulaSelecionar($foto["D011_Categoria"]);                if (!empty($rs_cat)):                    $rs2 = $rs_cat[0]['D011_Nome'];                else:                    $rs2 = 0;                endif;                $categoria .= $foto["D011_Uid"] . "-" . $rs2 . ",";                $model_fotos = new App_Model_aulafotosModel();                $rs_fotos = $model_fotos->aulaSelecionarFotos($foto["D011_Uid"]);                if (!empty($rs_fotos)):                    $rs = count($rs_fotos);                else:                    $rs = 0;                endif;                $arr .= $foto["D011_Uid"] . "-" . $rs . ",";                $rs_destaque = $model_fotos->aulaSelecionar($foto["D011_Imageminicio"]);                if (!empty($rs_destaque)):                    $rs1 = $rs_destaque[0]['D011_Imagem'];                else:                    $rs1 = "";                endif;                $destaque .= $foto["D011_Uid"] . "-" . $rs1 . ",";            endforeach;            $dados['Img_count'] = substr($arr, 0, -1);            $dados['Img_destaque'] = substr($destaque, 0, -1);            $dados['Img_categoria'] = substr($categoria, 0, -1);            //echo json_encode($usuario_lista_cad);            //funcao que chama a view            $this->View("cadastradoAula", $dados);        else:            //funcao que chama a view            $this->View("cadastradoAula");        endif;    }}